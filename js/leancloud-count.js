function init(t,e){var i=new AV.ACL;i.setPublicReadAccess(!0),i.setPublicWriteAccess(!0);var o=new t;o.setACL(i),o.set("url",e.url),o.set("title",e.title),o.set("visitors",e.visitors),o.set("likes",e.likes),o.save().then(function(t){console.log("Succed to create."),console.log("New object created with objectId: "+t.id+" / "+e.title)},function(t){console.log("Failed to create!"),console.error("Failed to create new object, with error message: "+t.message+" / "+e.title)})}function addVisitors(i,o){var t=new AV.Query(i);t.equalTo("url",o.url),t.find().then(function(t){if(0<t.length){var e=t[0];e.increment("visitors"),e.fetchWhenSave(!0),e.save().then(function(t){var e=t.get("visitors");$(document.getElementById(o.visitorNumberContainer)).text(e),console.log("Succed to add visitors."),console.log("New visitors: "+t.id+" "+t.get("url")+" "+t.get("visitors"))},function(t){console.log("Failed to add visitors!"),console.log("Error:"+t.code+" "+t.message)})}else init(i,o)},function(t){console.log("Error:"+t.code+" "+t.message)})}function addLikes(i,o){var t=new AV.Query(i);t.equalTo("url",o.url),t.find().then(function(t){if(0<t.length){var e=t[0];e.increment("likes"),e.fetchWhenSave(!0),e.save().then(function(t){var e=t.get("likes");$(document.getElementById(o.likeNumberContainer)).text(e),console.log("Succed to add likes."),console.log("New likes: "+t.id+" "+t.get("url")+" "+t.get("likes"))},function(t){console.log("Failed to add likes!"),console.log("Error:"+t.code+" "+t.message)})}else init(i,o)},function(t){console.log("Error:"+t.code+" "+t.message)})}function showVisitors(t,e){var i=new AV.Query(t),d=[];$(".leancloud_visitors").each(function(){d.push($(this).attr("data-url").trim())}),i.containedIn("url",d),i.find().then(function(t){var e=".leancloud_visitors_count";if(0!==t.length){for(var i=0;i<t.length;i++){var o=t[i],n=o.get("url"),r=o.get("visitors"),l=document.getElementById(n+"_visitors");$(l).find(e).text(r)}for(var s=0;s<d.length;s++){var a=d[s],c=document.getElementById(a+"_visitors");""==$(c).find(e).text()&&$(c).find(e).text(0)}}else $(".leancloud_visitors").find(e).text(0)},function(t){console.log("Error: "+t.code+" "+t.message)})}function showLikes(t,e){var i=new AV.Query(t),d=[];$(".leancloud_likes").each(function(){d.push($(this).attr("data-url").trim())}),i.containedIn("url",d),i.find().then(function(t){var e=".leancloud_likes_count";if(0!==t.length){for(var i=0;i<t.length;i++){var o=t[i],n=o.get("url"),r=o.get("likes"),l=document.getElementById(n+"_likes");$(l).find(e).text(r)}for(var s=0;s<d.length;s++){var a=d[s],c=document.getElementById(a+"_likes");""==$(c).find(e).text()&&$(c).find(e).text(0)}}else $(".leancloud_likes").find(e).text(0)},function(t){console.log("Error: "+t.code+" "+t.message)})}function topNPost(s){var t=new AV.Query("Counter");t.notEqualTo("id",0),t.descending("visitors"),t.limit(s),t.find().then(function(t){var e=s>t.length?t.length:s;if(0<e){for(var i=0;i<e;i++){var o=t[i],n="<ul class='topN-post-list'><li class='topN-post-item'><span class='item-topNumber'>TOP-"+(i+1)+"</span><a class='item-title' target='_blank' href='"+o.get("url")+"'>"+o.get("title")+"</a><i class='item-visitors'>「文章热度:"+o.get("visitors")+"℃」</i></li></ul>";$("#topN").append(n)}var r=".topN-title",l=$(r).attr("data-title").trim();$(r).text(l+"("+e+" posts)")}console.log("Succed to find topNPost.")},function(t){console.log("Error: "+t.code+" "+t.message)})}var postCookie={getCookie:function(t){for(var e=t+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){var n=i[o].trim();if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""},getCookieById:function(t,e){for(var i=t+"=",o=document.cookie.split(";"),n="",r=0;r<o.length;r++){var l=o[r].trim();0==l.indexOf(i)&&(n=l.substring(i.length,l.length))}if(""!=n)for(var s=n.split(","),a=0;a<s.length;a++){if(0==s[a].trim().indexOf(e))return!0}return""},addCookieById:function(t,e,i){var o=this.getCookie(t);if(""==o)o=e;else{for(var n=o.split(","),r=0,l=0;l<n.length;l++){if(0==n[l].trim().indexOf(e)){r=1;break}}0==r&&(o+=","+e)}var s=new Date;s.setTime(s.getTime()+24*i*60*60*1e3);var a="expires="+s.toGMTString();document.cookie=t+"="+o+"; "+a}};function annieAddData(i,o){if(1==$(".leancloud_visitors").length&&addVisitors(i,o),1==$(".leancloud_likes").length){var n=$(".leancloud_likes").attr("data-url").trim(),r=postCookie.getCookieById("star",n);""!=r&&($(".leancloud_likes").addClass("star-animation"),$("#star-button").addClass("star-animation")),showLikes(i,o),$("#navigation-hide").on("click","#star-button",function(){var t=$(".leancloud_likes"),e=$("#star-button");"unlike"===t.attr("rel")&&""==r?(addLikes(i,o),t.addClass("star-animation").attr("rel","like"),e.addClass("star-animation").attr("rel","like"),postCookie.addCookieById("star",n,.5)):alert("您已经点赞过啦!")})}}function annieShowData(t,e){1<=$(".leancloud_visitors").length&&showVisitors(t,e),1<=$(".leancloud_likes").length&&showLikes(t,e)}var post={url:$(".leancloud_likes").attr("data-url")||$(".leancloud_visitors").attr("data-url")?$(".leancloud_likes").attr("data-url").trim()||$(".leancloud_visitors").attr("data-url").trim():" ",title:$(".leancloud_likes").attr("data-title")||$(".leancloud_visitors").attr("data-title")?$(".leancloud_likes").attr("data-title").trim()||$(".leancloud_visitors").attr("data-title").trim():" ",likes:0,visitors:1,visitorNumberContainer:$(".leancloud_visitors_count").attr("id")?$(".leancloud_visitors_count").attr("id").trim():" ",likeNumberContainer:$(".leancloud_likes_count").attr("id")?$(".leancloud_likes_count").attr("id").trim():" "},urlCheck=/((https|http|ftp|rtsp|mms):\/\/)?(([0-9a-z_!~*'().&=+$%-]+:)?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}\.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+\.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\.[a-z]{2,6})(:[0-9]{1,4})?((\/?)|(\/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+\/?)/g,urlCheckStatus=urlCheck.test(CONFIG_LEACLOUD_COUNT.serverURLs);urlCheckStatus?AV.init({appId:CONFIG_LEACLOUD_COUNT.appId,appKey:CONFIG_LEACLOUD_COUNT.appKey,serverURLs:CONFIG_LEACLOUD_COUNT.serverURLs}):(AV.init({appId:CONFIG_LEACLOUD_COUNT.appId,appKey:CONFIG_LEACLOUD_COUNT.appKey}),console.log("The format of <"+CONFIG_LEACLOUD_COUNT.serverURLs+"> is not correct!"));var initCounter=AV.Object.extend("Counter"),initPost=post;$(".layout-post").length&&annieAddData(initCounter,initPost),($(".layout-pure").length||$(".layout-cart").length)&&1<=$(".post-title").length&&annieShowData(initCounter,initPost);